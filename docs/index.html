html_content = """<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Mapa Interativo - Piperaceae</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
  <style>
    body { margin:0; padding:0; }
    #topbar {
      position:absolute; top:0; left:0; width:100%; height:80px;
      background:white; z-index:1002;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      font-size:24px; font-weight:bold;
      box-shadow:0 2px 4px rgba(0,0,0,0.1);
      padding-top:5px; box-sizing:border-box;
    }
    #map { position:absolute; top:80px; right:0; bottom:0; left:300px; }
    #sidebar {
      position:absolute; top:90px; left:10px; bottom:10px; width:280px;
      background:white; padding:10px; overflow-y:auto;
      z-index:1001; box-shadow:0 0 5px rgba(0,0,0,0.5);
    }
    input, button { width:100%; margin-bottom:5px; padding:5px; }
    .list-header { font-weight:bold; margin-top:10px; }
    .list-genus { margin-left:10px; }
    .list-species { margin-left:20px; color:#007bff; cursor:pointer; }
    .leaflet-bottom.leaflet-right .leaflet-control { right:0 !important; }
  </style>
</head>
<body>
  <div id="topbar">
    Mapa de coletas do HNUP<br>
    <span style="font-size:16px; font-weight:normal;">Laboratório de Vegetação Ripária - NUPELIA - UEM</span>
  </div>
  <div id="sidebar">
    <h2>Filtros</h2>
    <button onclick="clearAll()">Limpar seleção</button>
    <h3>Famílias</h3>
    <ul id="filterList" style="list-style:none; padding:0; margin:0;"></ul>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
  <script>
    const map = L.map('map').setView([-22.5, -53.5], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
      maxZoom:18, attribution:'Leaflet | © OpenStreetMap contributors'
    }).addTo(map);

    const markers = L.markerClusterGroup();
    const speciesMarkers = {}, genusMembers = {}, familyMembers = {};
    let allData=[];

    fetch('dados_piperaceae.json').then(r=>r.json()).then(data=>{
      allData = data;
      data.forEach(d=>{
        const sp=d.especie, gen=d.genero, fam=d.familia;
        const m = L.marker([d.latitude,d.longitude]).bindPopup(
          `<b>Espécie:</b>${sp}<br><b>Gênero:</b>${gen}<br><b>Família:</b>${fam}`
        );
        markers.addLayer(m);
        speciesMarkers[sp]=speciesMarkers[sp]||[]; speciesMarkers[sp].push(m);
        genusMembers[gen]=genusMembers[gen]||new Set(); genusMembers[gen].add(sp);
        familyMembers[fam]=familyMembers[fam]||new Set(); familyMembers[fam].add(gen);
      });
      map.addLayer(markers);
      buildFilterList();
    });

    function buildFilterList(){
      const ul=document.getElementById('filterList');
      Object.keys(familyMembers).sort().forEach(fam=>{
        const famLi=document.createElement('li');
        famLi.innerHTML=`<label><input type="checkbox" class="fam" value="${fam}"> ${fam}</label>`;
        ul.appendChild(famLi);
        familyMembers[fam].forEach(gen=>{
          const genLi=document.createElement('li');
          genLi.innerHTML=`<label class="list-genus"><input type="checkbox" class="gen" data-fam="${fam}" value="${gen}"> ${gen}</label>`;
          ul.appendChild(genLi);
          genusMembers[gen].forEach(sp=>{
            const spLi=document.createElement('li');
            spLi.innerHTML=`<label class="list-species"><input type="checkbox" class="sp" data-gen="${gen}" value="${sp}"> ${sp}</label>`;
            ul.appendChild(spLi);
          });
        });
      });
      document.querySelectorAll('#filterList input').forEach(cb=>{
        cb.addEventListener('change',updateFilters);
      });
    }

    function updateFilters(){
      markers.clearLayers();
      const selFams=[...document.querySelectorAll('.fam:checked')].map(i=>i.value);
      const selGens=[...document.querySelectorAll('.gen:checked')].map(i=>i.value);
      const selSps =[...document.querySelectorAll('.sp:checked')].map(i=>i.value);
      let toShow=new Set();
      // if species checked
      if(selSps.length>0) selSps.forEach(sp=>speciesMarkers[sp].forEach(m=>toShow.add(m)));
      // else if genus checked
      if(selGens.length>0) selGens.forEach(gen=>genusMembers[gen].forEach(sp=>speciesMarkers[sp].forEach(m=>toShow.add(m))));
      // else if family checked
      if(selFams.length>0) selFams.forEach(fam=>familyMembers[fam].forEach(gen=>genusMembers[gen].forEach(sp=>speciesMarkers[sp].forEach(m=>toShow.add(m)))));
      // if none, show all
      if(selSps.length+selGens.length+selFams.length===0){
        allData.forEach(d=>speciesMarkers[d.especie].forEach(m=>toShow.add(m)));
      }
      toShow.forEach(m=>markers.addLayer(m));
      if(toShow.size) map.fitBounds(L.featureGroup([...toShow]).getBounds().pad(0.25));
    }

    function clearAll(){
      document.querySelectorAll('#filterList input').forEach(i=>i.checked=false);
      updateFilters();
    }
  </script>
</body>
</html>"""

with open('/mnt/data/mapa_multiselect.html','w',encoding='utf-8') as f:
    f.write(html_content)

'/mnt/data/mapa_multiselect.html'
